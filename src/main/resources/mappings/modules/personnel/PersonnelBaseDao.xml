<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.personnel.dao.PersonnelBaseDao">
    
	<sql id="personnelBaseColumns">
		a.id AS "id",
		a.name AS "name",
		a.id_number AS "idNumber",
		a.nation AS "nation",
		a.birthday AS "birthday",
		a.status AS "status",
		a.blood_type AS "bloodType",
		a.police_depot_sign AS "policeDepotSign",
		a.police_id_number AS "policeIdNumber",
		a.personnel_type AS "personnelType",
		a.native_place AS "nativePlace",
		a.birth_place AS "birthPlace",
		a.grow_place AS "growPlace",
		a.population_character AS "populationCharacter",
		a.hjszd AS "hjszd",
		a.identity AS "identity",
		a.marriage_status AS "marriageStatus",
		a.secret_status AS "secretStatus",
		a.health_status AS "healthStatus",
		a.hjszdxz AS "hjszdxz",
		a.reason AS "reason",
		a.work_date AS "workDate",
        a.public_security_date AS "publicSecurityDate",
		a.jcgzjlsj AS "jcgzjlsj",
		a.gljsjzz AS "gljsjzz",
		a.jxyjxznx AS "jxyjxznx",
		a.politics_face AS "politicsFace",
		a.organization_date AS "organizationDate",
		a.workunit_code AS "workunitCode",
		a.workunit_name AS "workunitName",
		a.unit_code AS "unitCode",
		a.relationship_unit AS "relationshipUnit",
		a.bmhjz AS "bmhjz",
		a.job_abbreviation AS "jobAbbreviation",
		a.job_fullname AS "jobFullname",
		a.job AS "job",
		a.xggbbs AS "xggbbs",
		a.is_xggb AS "isXggb",
		a.category AS "category",
		a.expertise AS "expertise",
		a.award AS "award",
		a.assessment AS "assessment",
		a.remarks AS "remarks",
		a.photo AS "photo",
		a.sex AS "sex",
		a.create_by AS "createBy.id",
		a.create_org_id AS "createOrgId",
		a.create_id_no AS "createIdNo",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_org_id AS "updateOrgId",
		a.update_id_no AS "updateIdNo",
		a.update_date AS "updateDate",
		a.del_flag AS "delFlag",
		a.workunit_id AS "workunitId",
		a.education AS "education",
		a.phone_number AS "phoneNumber",
		a.sort AS "sort",
		a.actual_unit AS "actualUnit",
		a.actual_unit_id AS "actualUnitId"
	</sql>
	
	<sql id="personnelBaseJoins">
		LEFT JOIN sys_office o ON o.id = a.actual_unit_id
		LEFT JOIN sys_user u ON u.id = a.create_by
	</sql>

	<sql id="personnelBaseJoinsCopy">
                LEFT JOIN sys_office o ON o.id = a.workunit_id
                LEFT JOIN sys_user u ON u.id = a.create_by
    </sql>

	<select id="get" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT 
			<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoins"/>
		WHERE a.id = #{id}
	</select>

	<select id="findList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="name != null and name != ''">
				AND a.name LIKE '%'||#{name}||'%'
			</if>
			<if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
				AND a.birthday BETWEEN #{startDate} AND #{endDate}
			</if>
			<if test="startDate != null and startDate != ''">
				AND a.birthday &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND a.birthday &lt;= #{endDate}
			</if>
			<if test="policeIdNumber != null and policeIdNumber != ''">
				AND a.police_id_number LIKE '%'||#{policeIdNumber}||'%'
			</if>
			<if test="workunitId != null and workunitId != ''">
				AND a.workunit_Id = #{workunitId}
			</if>
			<if test="actualUnitId != null and actualUnitId != ''">
				AND a.actual_unit_id = #{actualUnitId}
			</if>
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			<choose>
				<when test="peopleStatus == '1'.toString()">
					and a.status in ('1','19','2','3','4','5','6')
				</when>
				<otherwise>
					and a.status not in  ('1','19','2','3','4','5','6')
				</otherwise>
			</choose>
			${sqlMap.dsf}
		</where>
		<!--<choose>
			<when test="officeId != null and officeId != '' ">
				AND ( o.ID = #{officeId} OR o.parent_ids LIKE'%,'||#{officeId}||',%' OR u.ID = #{createBy.id} or a.workunit_id = #{officeId} or u.office_id = #{officeId})
				&lt;!&ndash;AND ( o.parent_ids LIKE'%,'||#{officeId}||',%' or a.workunit_id = #{officeId} )&ndash;&gt;
			</when>
			<otherwise>
				AND ( o.ID = #{officeId} OR u.ID = #{createBy.id} or a.workunit_id=#{officeId})
			</otherwise>
		</choose>-->
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY
				<!--a.sort ASC-->
				cast(nullif(split_part(a.sort, '-', 1),'') as integer),
				cast(nullif(split_part(a.sort, '-', 2),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 3),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 4),'')as integer)
			</otherwise>
		</choose>
	</select>

	<select id="findPageOfWorkUnit" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoinsCopy"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="name != null and name != ''">
				AND a.name LIKE '%'||#{name}||'%'
			</if>
			<if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
				AND a.birthday BETWEEN #{startDate} AND #{endDate}
			</if>
			<if test="startDate != null and startDate != ''">
				AND a.birthday &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND a.birthday &lt;= #{endDate}
			</if>
			<if test="policeIdNumber != null and policeIdNumber != ''">
				AND a.police_id_number LIKE '%'||#{policeIdNumber}||'%'
			</if>
			<if test="workunitId != null and workunitId != ''">
				AND a.workunit_Id = #{workunitId}
			</if>
			<if test="actualUnitId != null and actualUnitId != ''">
				AND a.actual_unit_id = #{actualUnitId}
			</if>
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			<choose>
				<when test="peopleStatus == '1'.toString()">
					and a.status in ('1','19','2','3','4','5','6')
				</when>
				<otherwise>
					and a.status not in  ('1','19','2','3','4','5','6')
				</otherwise>
			</choose>
			${sqlMap.dsf}
		</where>
		<!--<choose>
			<when test="officeId != null and officeId != '' ">
				AND ( o.ID = #{officeId} OR o.parent_ids LIKE'%,'||#{officeId}||',%' OR u.ID = #{createBy.id} or a.workunit_id = #{officeId} or u.office_id = #{officeId})
				&lt;!&ndash;AND ( o.parent_ids LIKE'%,'||#{officeId}||',%' or a.workunit_id = #{officeId} )&ndash;&gt;
			</when>
			<otherwise>
				AND ( o.ID = #{officeId} OR u.ID = #{createBy.id} or a.workunit_id=#{officeId})
			</otherwise>
		</choose>-->
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY
				<!--a.sort ASC-->
				cast(nullif(split_part(a.sort, '-', 1),'') as integer),
				cast(nullif(split_part(a.sort, '-', 2),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 3),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 4),'')as integer)
			</otherwise>
		</choose>
	</select>

	<select id="findAllWorkInfo" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="name != null and name != ''">
				AND a.name LIKE '%'||#{name}||'%'
			</if>
			<if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
				AND a.birthday BETWEEN #{startDate} AND #{endDate}
			</if>
			<if test="startDate != null and startDate != ''">
				AND a.birthday &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND a.birthday &lt;= #{endDate}
			</if>
			<if test="policeIdNumber != null and policeIdNumber != ''">
				AND a.police_id_number LIKE '%'||#{policeIdNumber}||'%'
			</if>
			<if test="workunitId != null and workunitId != ''">
				AND a.workunit_Id = #{workunitId}
			</if>
			<if test="actualUnitId != null and actualUnitId != ''">
				AND a.actual_unit_id = #{actualUnitId}
			</if>
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			<!--${sqlMap.dsf}-->
			<choose>
				<when test="juFlag != null and juFlag != ''">
					
				</when>
				<when test="chuFlag != null and chuFlag != ''">
					AND (o.parent_ids LIKE'%,'||#{chuFlag}||',%' or o.id = #{chuFlag})
				</when>
				<when test="minFlag != null and minFlag != ''">
					AND a.id_number = #{minFlag}
				</when>
				<otherwise>
					${sqlMap.dsf}
				</otherwise>
			</choose>
			and a.status in ('1','19','2','3','4','5','6')
		</where>
		<!--<choose>
			<when test="officeId != null and officeId != '' ">
				AND ( o.ID = #{officeId} OR o.parent_ids LIKE'%,'||#{officeId}||',%' OR u.ID = #{createBy.id} or a.workunit_id = #{officeId} or u.office_id = #{officeId})
				&lt;!&ndash;AND ( o.parent_ids LIKE'%,'||#{officeId}||',%' or a.workunit_id = #{officeId} )&ndash;&gt;
			</when>
			<otherwise>
				AND ( o.ID = #{officeId} OR u.ID = #{createBy.id} or a.workunit_id=#{officeId})
			</otherwise>
		</choose>-->
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY
				<!-- a.sort ASC-->
				cast(nullif(split_part(a.sort, '-', 1),'') as integer),
				cast(nullif(split_part(a.sort, '-', 2),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 3),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 4),'')as integer)
			</otherwise>
		</choose>
	</select>


	<select id="findListCopy" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
			<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoinsCopy"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="name != null and name != ''">
				AND a.name LIKE '%'||#{name}||'%'
			</if>
			<if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
				AND a.birthday BETWEEN #{startDate} AND #{endDate}
			</if>
			<if test="startDate != null and startDate != ''">
				AND a.birthday &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND a.birthday &lt;= #{endDate}
			</if>
			<if test="policeIdNumber != null and policeIdNumber != ''">
				AND a.police_id_number LIKE '%'||#{policeIdNumber}||'%'
			</if>
			<if test="workunitId != null and workunitId != ''">
				AND a.workunit_Id = #{workunitId}
			</if>
			<if test="actualUnitId != null and actualUnitId != ''">
				AND a.actual_unit_id = #{actualUnitId}
			</if>
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			<if test="unitCode != null and unitCode != ''">
				and a.unit_code = #{unitCode}
			</if>
			/*${sqlMap.dsf}*/
		</where>
		<choose>
			<when test="officeId != null and officeId != '' ">
				AND ( o.ID = #{officeId} OR o.parent_ids LIKE'%,'||#{officeId}||',%' OR u.ID = #{createBy.id} or a.workunit_id = #{officeId} or u.office_id = #{officeId})
				<!--AND ( o.parent_ids LIKE'%,'||#{officeId}||',%' or a.workunit_id = #{officeId} )-->
			</when>
			<otherwise>
				AND ( o.ID = #{officeId} OR u.ID = #{createBy.id} or a.workunit_id=#{officeId})
			</otherwise>
		</choose>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY
				<!--ORDER BY a.update_date DESC-->
				cast(nullif(split_part(a.sort, '-', 1),'') as integer),
				cast(nullif(split_part(a.sort, '-', 2),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 3),'')as integer) ,
				cast(nullif(split_part(a.sort, '-', 4),'')as integer)

			</otherwise>
		</choose>
	</select>

	<select id="findPerson" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND a.name =#{name}
		</where>
	</select>
	
	<select id="findAllList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT 
			<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findNavList" resultType="java.util.Map">
		select * from personnel_nav order by id
	</select>
	<!--url在ztree中为关键字 会打开一个新的窗口-->
	<select id="findNavTree" resultType="java.util.Map">
		select a.id,a.name,a.url as aherf from personnel_nav as a order by id
	</select>

	<select id="findTableName" resultType="java.util.Map">
		select a.id,a.name,a.url as aherf,a.table_name as tablename from personnel_nav as a order by id
	</select>

	<select id="findTotalNum" parameterType="java.util.Map" resultType="java.util.Map">
		 ${sql}
	</select>

	<insert id="insert">
		INSERT INTO personnel_base(
			id,
			name,
			id_number,
			nation,
			birthday,
			status,
			blood_type,
			police_depot_sign,
			police_id_number,
			personnel_type,
			native_place,
			birth_place,
			grow_place,
			population_character,
			hjszd,
			identity,
			marriage_status,
			secret_status,
			health_status,
			hjszdxz,
			reason,
			work_date,
            public_security_date,
			jcgzjlsj,
			gljsjzz,
			jxyjxznx,
			politics_face,
			organization_date,
			workunit_code,
			workunit_name,
			unit_code,
			relationship_unit,
			bmhjz,
			job_abbreviation,
			job_fullname,
			job,
			xggbbs,
			is_xggb,
			category,
			expertise,
			award,
			assessment,
			remarks,
			photo,
			sex,
			create_by,
			create_org_id,
			create_id_no,
			create_date,
			update_by,
			update_org_id,
			update_id_no,
			update_date,
			del_flag,
			workunit_id,
			education,
			phone_number,
			<if test="actualUnit != null and actualUnit != ''">
			actual_unit,
            </if>
			<if test="actualUnitId != null and actualUnitId != ''">
			actual_unit_id,
            </if>
			sort
		) VALUES (
			#{id},
			#{name},
			#{idNumber},
			#{nation},
			#{birthday},
			#{status},
			#{bloodType},
			#{policeDepotSign},
			#{policeIdNumber},
			#{personnelType},
			#{nativePlace},
			#{birthPlace},
			#{growPlace},
			#{populationCharacter},
			#{hjszd},
			#{identity},
			#{marriageStatus},
			#{secretStatus},
			#{healthStatus},
			#{hjszdxz},
			#{reason},
			#{workDate},
			#{publicSecurityDate},
			#{jcgzjlsj},
			#{gljsjzz},
			#{jxyjxznx},
			#{politicsFace},
			#{organizationDate},
			#{workunitCode},
			#{workunitName},
			#{unitCode},
			#{relationshipUnit},
			#{bmhjz},
			#{jobAbbreviation},
			#{jobFullname},
			#{job},
			#{xggbbs},
			#{isXggb},
			#{category},
			#{expertise},
			#{award},
			#{assessment},
			#{remarks},
			#{photo},
			#{sex},
			#{createBy.id},
			#{createBy.office.id},
			#{createIdNo},
			#{createDate},
			#{updateBy.id},
			#{updateBy.office.id},
			#{updateIdNo},
			#{updateDate},
			#{delFlag},
			#{workunitId},
			#{education},
			#{phoneNumber},
			<if test="actualUnit != null and actualUnit != ''">
			 #{actualUnit},
            </if>
			<if test="actualUnitId != null and actualUnitId != ''">
			#{actualUnitId},
            </if>
			#{sort}
		)
	</insert>
	
	<update id="update">
		UPDATE personnel_base SET 	
			name = #{name},
			id_number = #{idNumber},
			nation = #{nation},
			birthday = #{birthday},
			status = #{status},
			blood_type = #{bloodType},
			police_depot_sign = #{policeDepotSign},
			police_id_number = #{policeIdNumber},
			personnel_type = #{personnelType},
			native_place = #{nativePlace},
			birth_place = #{birthPlace},
			grow_place = #{growPlace},
			population_character = #{populationCharacter},
			hjszd = #{hjszd},
			identity = #{identity},
			marriage_status = #{marriageStatus},
			secret_status = #{secretStatus},
			health_status = #{healthStatus},
			hjszdxz = #{hjszdxz},
			reason = #{reason},
			work_date = #{workDate},
            public_security_date = #{publicSecurityDate},
			jcgzjlsj = #{jcgzjlsj},
			gljsjzz = #{gljsjzz},
			jxyjxznx = #{jxyjxznx},
			politics_face = #{politicsFace},
			organization_date = #{organizationDate},
			workunit_code = #{workunitCode},
			workunit_name = #{workunitName},
			unit_code = #{unitCode},
			relationship_unit = #{relationshipUnit},
			bmhjz = #{bmhjz},
			job_abbreviation = #{jobAbbreviation},
			job_fullname = #{jobFullname},
			job = #{job},
			xggbbs = #{xggbbs},
			is_xggb = #{isXggb},
			category = #{category},
			expertise = #{expertise},
			award = #{award},
			assessment = #{assessment},
			remarks = #{remarks},
			photo = #{photo},
			sex = #{sex},
			update_by = #{updateBy.id},
			update_org_id = #{updateBy.office.id},
			update_id_no = #{updateIdNo},
			update_date = #{updateDate},
			workunit_id = #{workunitId},
			education = #{education},
			phone_number = #{phoneNumber},
			<if test="actualUnit != null and actualUnit != ''">
			actual_unit = #{actualUnit},
            </if>
			<if test="actualUnitId != null and actualUnitId != ''">
			actual_unit_id = #{actualUnitId},
            </if>
            sort = #{sort}
			WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE personnel_base SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>

	<update id="deleteByIds">
		UPDATE personnel_base SET
		del_flag = '1'
		WHERE id in <foreach collection="ids" item="item" index="index"
							 open="(" separator="," close=")">#{item}</foreach>
	</update>
	
	
	<select id="findInfosByCode" resultType="java.util.HashMap">
		SELECT
			pb.politics_face,
			count( pb.politics_face ),
			sd.label 
		FROM
			personnel_base pb
			LEFT JOIN sys_dict sd ON pb.politics_face = sd.
		VALUE
			
		WHERE
			sd.type = 'political_status' AND pb.del_flag = '0' AND sd.del_flag = '0'
			AND pb.status IN ( '1', '19', '2', '3', '4', '5', '6' )
		<if test="id != null and id != ''">
			AND pb.workunit_id = #{id}
		</if>	
		GROUP BY
			pb.politics_face,
			sd.label 
	</select>
	
	<select id="findJobInfosByCode" resultType="java.util.HashMap">
		SELECT
			pb.job,
			count( pb.job ),
			sd.label 
		FROM
			personnel_base pb
			LEFT JOIN sys_dict sd ON pb.job = sd.
		VALUE
			
		WHERE
			sd.type = 'personnel_gwlb' AND pb.del_flag = '0' AND sd.del_flag = '0'
		<if test="id != null and id != ''">
			AND pb.workunit_id = #{id}
		</if>
		GROUP BY
			pb.job,
			sd.label
	</select>
	
	<select id="findInfosByCodes" resultType="java.util.HashMap">
		SELECT
			pb.politics_face,
			count( pb.politics_face ),
			sd.label 
		FROM
			personnel_base pb
			LEFT JOIN sys_dict sd ON pb.politics_face = sd.
		VALUE
			
		WHERE
			sd.type = 'political_status' AND pb.del_flag = '0' AND sd.del_flag = '0'
			AND pb.workunit_id in	(
		<foreach collection="ids" item="id" index="index" separator=",">
		 	#{id}
		 </foreach>
		 )
		GROUP BY
			pb.politics_face,
			sd.label 
	</select>
	
	<select id="findJobInfosByCodes" resultType="java.util.HashMap">
		SELECT
			pb.job,
			count( pb.job ),
			sd.label 
		FROM
			personnel_base pb
			LEFT JOIN sys_dict sd ON pb.job = sd.
		VALUE
			
		WHERE
			sd.type = 'personnel_gwlb' AND pb.del_flag = '0' AND sd.del_flag = '0'
			AND pb.workunit_id in (
		<foreach collection="ids" item="id" index="index" separator=",">
		 	#{id}
		 </foreach>	
		)
		GROUP BY
			pb.job,
			sd.label
	</select>
	<select id="findInfoByIdNumber" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		where a.del_flag = '0' and a.id_number = #{idNumber} order by a.update_date desc limit 1
	</select>

	<select id="findByIdNumbers" resultType="com.thinkgem.jeesite.modules.personnel.entity.PoliceCertificate">
		SELECT
			<include refid="personnelBaseColumns"/>,
			b.name as rank
		FROM personnel_base a
			left join personnel_police_rank b on a.id_number=b.id_number
		where
			a.del_flag = '0' and
		 	AND a.id_number in
			<foreach collection="idNumbers" item="item" index="index" open="(" separator="," close=")">#{item}</foreach>
	</select>


	<update id="updateWorkUnitByIds">
		UPDATE personnel_base SET workunit_id =#{workUnitId} ,workunit_name = #{workUnitName}
		WHERE id in
		<foreach collection="ids" item="item" index="index"
				 open="(" separator="," close=")">#{item}
		</foreach>
	</update>

	<update id="updateActualWorkUnitByIds">
		UPDATE personnel_base SET actual_unit =#{actualUnitName} ,actual_unit_id = #{actualUnitId}
		WHERE id in
		<foreach collection="ids" item="item" index="index"
				 open="(" separator="," close=")">#{item}
		</foreach>
	</update>


	<select id="findByUnitName" resultType="java.lang.String">
		SELECT a.id_number as idNumber
		FROM personnel_base a
		WHERE a.workunit_name = #{unit} and a.name = #{name} and a.del_flag = '0'
	</select>

    <select id="findPersonNumByWorkunitId" resultType="java.lang.Integer">
	  SELECT count(DISTINCT a.name )
	 	FROM personnel_base a
		<include refid="personnelBaseJoins"/>
	 WHERE a.del_flag = '0'
	<!--<if test="id != null and id != ''">
		AND a.workunit_id = #{id}
	</if>-->
	<if test="id != null and id != ''">
		${id}
	</if>
	</select>

	<select id="findPersonNumByWorkunitIds" resultType="java.lang.Integer">
		SELECT count(DISTINCT a.name )
		FROM personnel_base a
		WHERE a.del_flag = '0'
		AND a.unit_id in (
		<foreach collection="ids" item="id" index="index" separator=",">
			#{id}
		</foreach>
		)
	</select>

	<select id="findInfoByIdName" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		<include refid="personnelBaseJoins"/>
		<where>
			a.del_flag = '0' AND a.name = #{name}
			${sqlMap.dsf}
		</where>
		ORDER BY a.update_date DESC LIMIT 1
	</select>

	<select id="findRegisterBase" resultType="java.util.HashMap">
		SELECT
			A.workunit_name,
			A.bmhjz,
			A.NAME,
			A.sex,
			A.id_number,
			A.birthday,
			A.nation,
			A.politics_face,
			A.organization_date,
			a.native_place AS hometown,
			A.police_id_number,
			A.work_date,
			A.public_security_date,
			C.register_date AS register_date,
			A.status,
			d.NAME AS job_name,
			d.work_date AS work_date,
			f.job_level AS job_level,
			f.start_date AS start_date,
			G.NAME AS rzzg_name,
			G.DATE AS qdzg_date,
			h.NAME AS jx_name,
			h.start_date AS jxqs_date,
			A.health_status,
			A.birth_place,
			A.expertise
		FROM
		personnel_base A
		LEFT JOIN (select * from personnel_civil_servant cs  where cs.register_date = (select max(register_date) from personnel_civil_servant where cs.id_number = id_number)) C ON C.id_number = A.id_number
		LEFT JOIN (select * from personnel_administration pa where pa.work_date = (select max(work_date) from personnel_administration where pa.id_number = id_number)) d ON d.id_number = A.id_number
		LEFT JOIN (select * from personnel_job pj where pj.start_date = (select max(start_date) from personnel_job where pj.id_number = id_number)) f ON (f.id_number = A.id_number)
		LEFT JOIN (select * from personnel_police_work2 pw where pw."date" = (select max("date") from personnel_police_work2 where pw.id_number = id_number))G ON (G.id_number = A.id_number)
		LEFT JOIN (select * from personnel_police_rank r where r.start_date = (select max(start_date) from personnel_police_rank where r.id_number = id_number)) h on h.id_number = a.id_number
		WHERE
			A.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			AND a.status in ('1','2','3','4','5','6')
	</select>

	<select id="findLastRegisterBase" resultType="map">
			SELECT
			A.workunit_name,
			A.bmhjz,
			A.NAME,
			A.sex,
			A.id_number,
			A.birthday,
			A.nation,
			A.politics_face,
			A.organization_date,
			b.hometown AS hometown,
			A.police_id_number,
			A.work_date,
			A.public_security_date,
			C.register_date AS register_date,
			A.status,
			d.NAME AS job_name,
			d.work_date AS work_date,
			f.job_level AS job_level,
			f.start_date AS start_date,
			G.NAME AS rzzg_name,
			G.DATE AS qdzg_date,
			G.level as level,
			h.NAME AS jx_name,
			h.start_date AS jxqs_date,
			A.health_status,
			A.birth_place,
			A.expertise
		FROM
			personnel_base	A
			LEFT JOIN personnel_hometown_address b ON b.address = A.native_place

			left join (select * from personnel_civil_servant aa where aa.register_date = (select max(register_date) from personnel_civil_servant a where aa.id_number = id_number))  C ON  C.id_number = A.id_number
			left join (select * from personnel_administration aaa where aaa.work_date = (select max(work_date) from personnel_administration where aaa.id_number = id_number)) d on d.id_number = a.id_number
			left join (select * from personnel_job bb where bb.start_date =  (select max(start_date) from personnel_job where bb.id_number = id_number)  and bb.approval_date =(select max(approval_date) from personnel_job where bb.id_number = id_number)) f on f.id_number=a.id_number
			left join (select * from personnel_police_work2 bbb where bbb."date" = (select max(date) from personnel_police_work2 where bbb.id_number = id_number)) g on g.id_number = a.id_number

			left join (select * from personnel_police_rank cc where cc.start_date = (select max(start_date) from personnel_police_rank where cc.id_number = id_number))  h on h.id_number = a.id_number
		WHERE
			A.del_flag = '0'
			AND A.status IN ( '1', '2', '3', '4', '5', '6' )
		<if test="idNumber != null and idNumber != ''">
			and a.id_number = #{idNumber}
		</if>
	</select>

	<select id="findNoRegisterBase" resultType="java.util.HashMap">
		SELECT
		A.workunit_name,
		A.bmhjz,
		A.NAME,
		A.sex,
		A.id_number,
		A.birthday,
		A.nation,
		A.politics_face,
		A.organization_date,
		b.hometown AS hometown,
		A.police_id_number,
		A.work_date,
		A.public_security_date,
		C.register_date AS register_date,
		A.status,
		d.NAME AS job_name,
		d.work_date AS work_date,
		f.job_level AS job_level,
		f.start_date AS start_date,
		G.NAME AS rzzg_name,
		G.DATE AS qdzg_date,
		h.NAME AS jx_name,
		h.start_date AS jxqs_date,
		A.health_status,
		A.birth_place,
		A.expertise
		FROM
		personnel_base
		A LEFT JOIN personnel_hometown_address b ON b.address = A.native_place
		LEFT JOIN personnel_civil_servant C ON (C.id_number = A.id_number) and c.register_date = (select MAX(register_date) from personnel_civil_servant)
		LEFT JOIN personnel_administration d ON (d.id_number = A.id_number) and d.work_date = (select MAX(work_date) from personnel_administration)
		LEFT JOIN personnel_job f ON (f.id_number = A.id_number) and f.start_date = (SELECT MAX(start_date) from personnel_job)
		LEFT JOIN personnel_police_work2 G ON (G.id_number = A.id_number) and g.date  = (select MAX(date) from personnel_police_work2)
		LEFT JOIN personnel_police_rank h ON (h.id_number = A.id_number) and h.start_date = (select MAX(start_date) from personnel_police_rank)
		WHERE
		A.del_flag = '0'
		<if test="idNumber != null and idNumber != ''">
			and a.id_number = #{idNumber}
		</if>
		AND a.status in ('7','8','9')
	</select>

	<select id="findQrzXueLiInfo" resultType="java.util.HashMap">
		select a.id_number,a.type1,a.name,a.end_date,a.major_code,a.school_name from personnel_xueli a  where a.start_date = (
		select max(start_date) from personnel_xueli where id_number = a.id_number and type1 = '1'
		) and a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>  GROUP BY a.id_number,a.type1,a.name,a.end_date,a.major_code,a.school_name
	</select>

	<select id="findZzXueLiInfo" resultType="java.util.HashMap">
		select MAX(level),a.id_number,a.type1,a.name,a.end_date,a.major_code,a.school_name from personnel_xueli a where a.start_date = (
		select max(start_date) from personnel_xueli where id_number = a.id_number and type1 = '2'
		) and a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>  GROUP BY a.id_number,a.type1,a.name,a.end_date,a.major_code,a.school_name
	</select>

	<select id="findQrzXueWeiInfo" resultType="java.util.HashMap">
		select MAX(a.level),a.id_number,a.name from personnel_academic_degree a where a.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if> AND a.type = '1' GROUP BY a.id_number, a.name
	</select>

	<select id="findZzXueWeiInfo" resultType="java.util.HashMap">
		select MAX(a.level),a.id_number,a.name from personnel_academic_degree a where a.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if> AND a.type= '2' GROUP BY a.id_number, a.name
	</select>


	<select id="findCheckInfo" resultType="java.util.HashMap">
		select a.year, a.id_number,a.conclusion from personnel_year_check a where a.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			 and a.year &gt;  to_char((SELECT now()::timestamp+ '-3 year'),'yyyy')
			 GROUP BY a.id_number,a.conclusion ,a.year ORDER BY year

	</select>

	<select id="findLvLiInfo" resultType="java.util.HashMap">
		select a.id_number,a.start_date,a.end_date,a.explain from personnel_resume a where a.del_flag = '0' and a.explain &lt;&gt; ''
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
	</select>

	<select id="findJiangLiInfo" resultType="java.util.HashMap">
		select a.id_number, a.approcal_date, a.name, a.file_no, a.approval_org_name from personnel_reward a where a.del_flag = '0' and a.name &lt;&gt; ''and a.approval_org_name &lt;&gt; ''
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
			order by a.approcal_date
	</select>

	<select id="findChengJieInfo" resultType="java.util.HashMap">
		select a.id_number, a.name, a.file_no, a.approval_org,a.approval_date from personnel_punish a where a.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
		order by a.approval_date
	</select>

	<select id="findFamilyInfo" resultType="java.util.HashMap">
		select a.id_number, a.name, a.relationship, a.birthday, a.politics_face, a.unit_name_job from personnel_family a where a.del_flag = '0'
			<if test="idNumber != null and idNumber != ''">
				and a.id_number = #{idNumber}
			</if>
	</select>
	<select id="findHealthReferenceList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
		from personnel_base a
		<include refid="personnelBaseJoins"/>
		where a.del_flag = '0'
		 ${sqlMap.dsf}
		 and a.id_number not in
		(select b.id_number from affair_health_checkup b  where b.del_flag = '0' and b.id_number  is not null
		<choose>
			<when test="month != null and month !=''">
				AND TO_CHAR(b.tj_date, 'yyyy-mm')  = #{month}
			</when>
			<when test="year != null and year !=''">
				AND extract(year from b.tj_date) = #{year}
			</when>
			<when test="startDate != null and endDate != null">
				AND b.tj_date between  #{startDate,jdbcType=DATE} and #{endDate,jdbcType=DATE}
			</when>
			<when test="startDate != null">
				AND b.tj_date >= #{startDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND  #{endDate,jdbcType=DATE} >= b.tj_date
			</when>
			<otherwise>
			</otherwise>
		</choose>
		)
	</select>

	<select id="findPoliticsFaceList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
		FROM personnel_base a
		LEFT JOIN sys_office o ON o.id = a.workunit_id
		LEFT JOIN sys_user u ON u.id = a.create_by
		LEFT JOIN sys_dict sd
		ON a.politics_face = sd. VALUE
		WHERE sd.type = 'political_status' AND a.del_flag = '0' AND sd.del_flag = '0'
		AND a.status IN ( '1', '19', '2', '3', '4', '5', '6' )
		and sd.label = #{label}
		${sqlMap.dsf}
		<choose>
			<when test="month != null and month !=''">
				AND TO_CHAR(a.create_date, 'yyyy-mm')  = #{month}
			</when>
			<when test="year != null and year !=''">
				AND extract(year from a.create_date) = #{year}
			</when>
			<when test="startDate != null and endDate != null">
				AND a.create_date between  #{startDate,jdbcType=DATE} and #{endDate,jdbcType=DATE}
			</when>
			<when test="startDate != null">
				AND a.create_date >= #{startDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND  #{endDate,jdbcType=DATE} >= a.create_date
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findOneMonthTX" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM
		personnel_base a
		WHERE
		A.del_flag = '0'
		AND
		(
		(A.sex = '1'
		AND(
		(CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 60 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		AND
		CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER ) - 1 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER )
		)
		OR
		(CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 59 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		AND
		CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER )+1=13)
		AND
		CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER ) - 1 = 0
		)
		)
		OR
		(A.sex = '2'
		AND
		(
		(CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 55 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		AND
		CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER ) - 1 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER )
		)
		OR
		(CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 54 = CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		AND
		CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER )+1=13)
		AND
		CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 6, 2 ) AS INTEGER ) - 1 = 0
		)
		)

		)
	</select>

    <select id="findInfosByIds" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns" />
		FROM
		personnel_base a
		WHERE
		A.del_flag = '0' AND id in <foreach collection="ids" index="index" item="id" open="(" separator="," close=")">#{id}</foreach>

	</select>
	<select id="findInfoByIdUnitId" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
			a.id AS "id",
			a.name AS "name",
			a.id_number AS "idNumber"
		FROM personnel_base a
		WHERE a.del_flag = '0'
			AND a.workunit_id = #{officeId}
		ORDER BY a.name
	</select>

    <select id="selectBean" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select
			*
		FROM
			personnel_base
		WHERE
			del_flag = '0'
			and id_number = #{idNumber}
	</select>

	<select id="findManTXList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT <include refid="personnelBaseColumns" />
		FROM   personnel_base A where
		A.del_flag = '0'
		AND
		A.sex = '1'
		AND
		(CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 60 =
		CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		OR
		CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER ) + 59 =
		CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		)
	</select>
	<select id="findWomanList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns" />
		from personnel_base	A
		where A.del_flag = '0'
		AND A.sex = '2'
		AND
		(
		CAST ( SUBSTRING ( TO_CHAR( CURRENT_DATE, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		- CAST ( SUBSTRING ( TO_CHAR( A.birthday, 'yyyy-mm-dd' ), 1, 4 ) AS INTEGER )
		)>=54
	</select>
    <select id="findInfoByList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		SELECT
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		where a.id_number in
		<foreach collection="list" item="item" open="(" separator="," close=")" index="index">
			#{item.idNumber}
		</foreach>
		ORDER BY a.update_date DESC
	</select>
	<select id="findUserMessage" resultType="PersonnelBase">
		select * from sys_user u,personnel_base pb where u.login_name = #{loginName} and u.no = pb.id_number and u.del_flag = '0'
	</select>
	<select id="findUserUnit" resultType="java.util.HashMap">
		select DISTINCT o.code,o.name from "sys_user" u,sys_office o where u.office_id = #{loginName} and u.office_id = o.id
	</select>
	<select id="findUserUnitId" resultType="String">
		select u.id from sys_user u,sys_office o where u.no = o.code and o.code = #{code}
	</select>

	<select id="selectByIdNumbers" resultType="com.thinkgem.jeesite.modules.personnel.entity.PoliceCertificate">
		SELECT
			<include refid="personnelBaseColumns"/>,
		b.name as rank
			FROM personnel_base a
			left join personnel_police_rank b on a.id_number=b.id_number
		where
			a.del_flag = '0'
			AND b.status = #{status}
			AND a.id_number in
			<foreach collection="idNumbers" item="item" index="index" open="(" separator="," close=")">#{item}</foreach>
	</select>

    <select id="selectUnitName" resultType="java.lang.String">
		select
		 	workunit_name
		 from
		 	personnel_base
		 where
			id_number = #{idN}
	</select>

	<select id="selectUnitId" resultType="java.lang.String">
		select
		 	workunit_code
		 from
		 	personnel_base
		 where
			id_number = #{idNumber}
	</select>

	<select id="findBmhjzByUnitId" resultType="java.lang.String">
		select DISTINCT bmhjz
		from personnel_base a
		left join sys_office o on o.id = a.workunit_id
		where
		a.del_flag = '0'
		and a.status in ('1','10','19','2','3','4','5','6')
		and (o.id = #{unitId} or o.parent_ids LIKE '%,'||#{unitId}||',%')
	</select>

	<select id="findjobAbbreviationByUnitId" resultType="java.lang.String">
		select DISTINCT job_abbreviation
		from personnel_base a
		left join sys_office o on o.id = a.workunit_id
		where
		a.del_flag = '0'
		and a.status in ('1','10','19','2','3','4','5','6')
		and (o.id = #{unitId} or o.parent_ids LIKE '%,'||#{unitId}||',%')
	</select>

    <select id="selectUnit" resultType="java.lang.String">
		select
		 	workunit_name
		 from
		 	personnel_base
		where
			name = #{name}
			and  del_flag = '0'
			LIMIT 1
	</select>

	<select id="findUnitByIdNumber" resultType="Map">
		select
		a.workunit_name AS unit,
		a.workunit_id AS unitId
		from
		personnel_base a
		where a.id_number = #{idNumber}
	</select>

	<update id="updateWorkUnitId" >
		update
		personnel_base a
		set
		workunit_name = #{actualUnit},
		workunit_id = #{actualUnitId}
		where a.id_number = #{idNumber}
	</update>

	<select id="findAllUserByUnitId" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select
		<include refid="personnelBaseColumns"/>
		FROM personnel_base a
		where
		a.del_flag = '0'
		AND a.workunit_id = #{unitId}
		AND a.status in ('1','19','2','3','4','5','6')
	</select>

	<select id="countPersonnelAge" resultType="map">
		select sd.label,count(sd.label) from personnel_base a
		left join sys_dict sd on sd."value" =a.sex
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND u.status in ('1','19','2','3','4','5','6')
		and sd."type" = 'sex'
		<if test="id != null and id != ''">
			and ( o.parent_ids like '%${id}%' or o.id = #{id})
		</if>
		<choose>
			<when test="month != null and month !=''">
				AND TO_CHAR(a.birthday, 'yyyy-mm') = #{month}
			</when>
			<when test="year != null and year !=''">
				AND extract(year from a.birthday) = #{year}
			</when>
			<when test="startDate != null and startDate != null">
				AND a.birthday between  #{startDate,jdbcType=DATE} and #{endDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND a.birthday >= #{startDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND  #{endDate,jdbcType=DATE} >= a.birthday
			</when>
			<otherwise>
			</otherwise>
		</choose>
		GROUP BY sd.label
	</select>

	<select id="countNation" resultType="map">
		select sd.label,count(sd.label)
		from personnel_base a
		left join sys_dict sd on a.nation = sd."value"
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0' and sd."type" = 'nation'
		<if test="id != null and id != ''">
			and ( o.parent_ids like '%${id}%' or o.id = #{id})
		</if>
		AND a.status in ('1','19','2','3','4','5','6')
		GROUP BY sd.label
	</select>

	<select id="countPersonnelCategory" resultType="map">
		select a.personnel_type as label,count(a.personnel_type)
		from personnel_base a
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND u.status in ('1','19','2','3','4','5','6')
		<if test="id != null and id != ''">
			and ( o.parent_ids like '%${id}%' or o.id = #{id})
		</if>
		GROUP BY a.personnel_type
	</select>

	<select id="countWorkYear" resultType="map">
		select cast(count((CURRENT_DATE - a.work_date)/365) as integer) as count,
		cast((CURRENT_DATE - a.work_date)/365  as integer ) as label
		from personnel_base a
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND a.status in ('1','19','2','3','4','5','6')
		<if test="id != null and id != ''">
			and ( o.parent_ids like '%${id}%' or o.id = #{id})
		</if>
		GROUP BY (CURRENT_DATE - a.work_date)/365
	</select>

	<select id="findAgeList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
		from personnel_base a
		left join sys_dict sd on sd."value" =a.sex
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND a.status in ('1','19','2','3','4','5','6')
		and sd."type" = 'sex'
		<if test="unitId != null and unitId != ''">
			and ( o.parent_ids like '%${unitId}%' or o.id = #{unitId})
		</if>
		<choose>
			<when test="month != null and month !=''">
				AND TO_CHAR(a.birthday, 'yyyy-mm') = #{month}
			</when>
			<when test="year != null and year !=''">
				AND extract(year from a.birthday) = #{year}
			</when>
			<when test="startDate != null and startDate != null">
				AND a.birthday between  #{startDate,jdbcType=DATE} and #{endDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND a.birthday >= #{startDate,jdbcType=DATE}
			</when>
			<when test="endDate != null">
				AND  #{endDate,jdbcType=DATE} >= a.birthday
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<if test="label != null and label != ''">
			and sd.label = #{label}
		</if>
	</select>

	<select id="findChartsNationList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
		from personnel_base a
		left join sys_dict sd on a.nation = sd."value"
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0' and sd."type" = 'nation'
		AND u.status in ('1','19','2','3','4','5','6')
		<if test="unitId != null and unitId != ''">
			and ( o.parent_ids like '%${unitId}%' or o.id = #{unitId})
		</if>
		<if test="label != null and label != ''">
			and sd.label = #{label}
		</if>
	</select>

	<select id="findChartsCategoryList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
		from personnel_base a
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND u.status in ('1','19','2','3','4','5','6')
		<if test="unitId != null and unitId != ''">
			and ( o.parent_ids like '%${unitId}%' or o.id = #{unitId})
		</if>
		<if test="label != null and label != ''">
			and a.personnel_type = #{label}
		</if>
	</select>


    <select id="findChartsWorkYearList" resultType="com.thinkgem.jeesite.modules.personnel.entity.PersonnelBase">
		select <include refid="personnelBaseColumns"/>
        from personnel_base a
		left join personnel_base u on a.id_number = u."id_number"
		left join sys_office o on u."workunit_id" = o."id"
		where a.del_flag = '0'
		AND u.status in ('1','19','2','3','4','5','6')
		<if test="unitId != null and unitId != ''">
			and ( o.parent_ids like '%${unitId}%' or o.id = #{unitId})
		</if>
        GROUP BY a.id ,
		a.name,
		a.id_number ,
		a.nation ,
		a.birthday,
		a.status ,
		a.blood_type ,
		a.police_depot_sign ,
		a.police_id_number,
		a.personnel_type ,
		a.native_place ,
		a.birth_place,
		a.grow_place ,
		a.population_character ,
		a.hjszd ,
		a.identity ,
		a.marriage_status ,
		a.secret_status ,
		a.health_status ,
		a.hjszdxz,
		a.reason ,
		a.work_date ,
		a.public_security_date ,
		a.jcgzjlsj,
		a.gljsjzz ,
		a.jxyjxznx ,
		a.politics_face ,
		a.organization_date ,
		a.workunit_code ,
		a.workunit_name ,
		a.unit_code ,
		a.relationship_unit ,
		a.bmhjz ,
		a.job_abbreviation ,
		a.job_fullname ,
		a.job ,
		a.xggbbs ,
		a.is_xggb ,
		a.category ,
		a.expertise ,
		a.award ,
		a.assessment ,
		a.remarks ,
		a.photo ,
		a.sex ,
		a.create_by ,
		a.create_org_id,
		a.create_id_no ,
		a.create_date ,
		a.update_by ,
		a.update_org_id,
		a.update_id_no,
		a.update_date ,
		a.del_flag ,
		a.workunit_id ,
		a.education ,
		a.phone_number ,
		a.sort ,
		a.actual_unit ,
		a.actual_unit_id
        HAVING
        (CURRENT_DATE - a.work_date)/365  &gt; ${startAge} and (CURRENT_DATE - a.work_date)/365  &lt;= ${endAge}
	</select>

	<select id="getIdNumberById" resultType="java.lang.String">
		select
		a.id_number
		from
		personnel_base a
		where a.id = #{id}
	</select>

	<select id="selCountByUnirId" resultType="java.lang.Integer">
		select
		count(*) from  personnel_base a
		left join sys_office o on o.id = a.actual_unit_id
		where a.del_flag = '0'
		and o.del_flag = '0'
		and (o.id = #{chuId} or o.parent_id = #{chuId} or o.parent_ids like '%,'||#{chuId}||',%')
		and a.status in ('1','19','2','3','4','5','6')
	</select>

</mapper>